<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script th:replace="fragments :: boot"></script>
<script>
$(document).ready(function(){
	var cnt = 1;
	var result = $('#result').val();
	if(result==1) alert('아이디 혹은 비밀번호를 잘못 입력하셨습니다');
	
	$('#chatEnter').click(function(){
		if(document.getElementById('quest').value == '')
			return;
		chatbot();
		document.getElementById('quest').value = null;
	});
	$('#chatform').keypress(function(e){
		if(document.getElementById('quest').value == '')
			return;
		if(e.keyCode == 13){
			chatbot();
			document.getElementById('quest').value = null;
		}
	});
	$('.close').click(function(){
		document.getElementById('addAnswer').remove();
	});
});

function chatbot(){
	var divQ = document.createElement('div');
	divQ.innerHTML = '<div style="display:inline-block;margin:2px;float:right;background-color:#eec550;color:white; border-radius:10px; margin-top:10px;"><div style="margin:5px; ">'+$('#quest').val()+'</div></div><br>';
	document.getElementById('addAnswer').appendChild(divQ);
	$.ajax({
		url:'[[@{/chatbot}]]',
		data:{
			quest:$('#quest').val()
		},
		success:function(data){
			var divA = document.createElement('div');
			divA.innerHTML = '<div style="display:inline-block;background-color:#2c2955;color:white; border-radius:10px;max-width:70%; margin-top:25px;"><div style="margin:5px; ">'+data+'</div></div><br>';
			document.getElementById('addAnswer').appendChild(divA);
			var chat = document.querySelector('#chatBasic');
	        chat.scrollTop = chat.scrollHeight;
		}
	});
	
	var chat = document.querySelector('#chatBasic');
    chat.scrollTop = chat.scrollHeight;
};

function loginchk(){
	var form = document.loginform;
	var email = form.email.value;
	var pwd = form.pwd.value;
		
	if(email==""){
		alert('이메일을 입력해주세요');
		form.email.focus();
		event.preventDefault();
		return;
	}
	if(pwd==""){
		alert('비밀번호를 입력해주세요');
		form.pwd.focus();
		event.preventDefault();
		return;
	}
	form.action = '[[@{/loginimpl}]]';
	form.submit();
}
</script>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>로그인</title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="assets/img/logo_adobe_express.svg" />
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v6.1.0/js/all.js" crossorigin="anonymous"></script>
        <!-- fonts-->
 		<link href='//spoqa.github.io/spoqa-han-sans/css/SpoqaHanSansNeo.css' rel='stylesheet' type='text/css'>
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
    </head>
    <body id="page-top">
        <!-- Navigation-->
        <nav th:replace="fragments :: nav-top"></nav>
        <!-- Login -->
        <section class="page-section" id="login">
        	<form name="loginform" id="loginform" method="post" style="border-radius:10px;background-color:#f8f2e277;">
        		<input type="hidden" id="result" th:value="${session.result}"/>
                <h3>로그인</h3><br>
                <input type="text" name="email" id="email" placeholder="이메일"/><br><br>
                <input type="password" name="pwd" id="pwd" placeholder="비밀번호"/><br><br>
                <div class="link" style="width:400px;margin:0 auto;">
	                <ul style="width:400px;padding:0">
	                	<a type="button" data-bs-toggle="modal" data-bs-target="#exampleModal1">이메일 찾기</a>
	                	<a type="button" data-bs-toggle="modal" data-bs-target="#exampleModal2">비밀번호 찾기</a>
	                	<a th:href="@{/register}">회원가입</a>
	                </ul>
                </div>
                <button id="loginbtn" onclick="loginchk()">로그인하기</button>
            </form>
        </section>
        
        <a id="chatbot" href="#" data-bs-toggle="modal" data-bs-target="#modal_chatbot" class="img" style="position: fixed; top:86%; right: 3%; width:100px; background-image: url(assets/img/chatbot1.png); width:150px; height:100px; z-index:10;"></a>
        
		<div class="modal fade" id="modal_chatbot" role="dialog" data-backdrop="static" data-keyboard="false">
		    <div class="modal-dialog modal-2sm">
		      <div class="modal-content" style="width:100%;">
		        <div class="modal-header">
		          <div>모든 문의사항 편하게 질문해주세요:)</div>
		          <button type="button" class="btn-close close" data-bs-dismiss="modal" aria-label="Close"></button>
		          <h4 class="modal-title"></h4>
		        </div>
		        
		        <div id="chatBasic" class="modal-body" style="height:500px;overflow:scroll;">
		        	<div style="display:inline-block;background-color:#2c2955;color:white; border-radius:10px;max-width:70%;"><div style="margin:5px;">안녕하세요 이웃집하로입니다:)<br>어떤것을 도와드릴까요?</div></div>
			        <div id="addAnswer"></div>
		        </div>
		        <div class="modal-footer" style="justify-content: flex-start;">
					<div class="col-md-10" style="float:left;" id="chatform">
						<input id="quest" type="text" style="width:100%;">
					</div>
					<button type="button" class="btn btn-primary" id="chatEnter" style="float: right;">전송</button>
		        </div>
		      </div>
		    </div>
	    </div>
	    <!-- Modal-->
		<div class="modal fade" id="exampleModal1" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header">
		        <h1 class="modal-title fs-5" id="exampleModalLabel">이메일 찾기</h1>
		        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		      </div>
		      <div class="modal-body">
		        <div class="mb-3">
				  <label for="useremail" class="form-label">이메일</label>
				  <input type="text" id="useremail" name="useremail" class="form-control" placeholder="예) id@example.com" oninput="checkId(), activateJoinbtn()"/>
				  <font color = "red" id = "mailform" style = "display:none">올바른 이메일 형식이 아닙니다</font>
				  <font color = "red" id = "fail" style = "display:none">이미 존재하는 이메일입니다</font>
				  <font color = "green" id = "mailcon" style = "display:none">사용 가능한 이메일입니다</font>
				</div>
				<div class="input-group">
				  <input class="form-control mail-check-input" placeholder="인증번호 6자리를 입력해주세요" disabled="disabled">
				  <span><input type="button" class="form-control btn btn-secondary text-dark" id="mail-Check-Btn" value="인증 요청" style="background-color:#ece2c4;"></span>
				</div>
				<span class="mb-3" id="mail-check-warn"></span>
		      </div>
		      <div class="modal-footer">
		        <button id="closebtn" type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
		        <button id="askbtn" type="button" class="btn btn-primary" onclick="askregister();">등록</button>
		      </div>
		    </div>
		  </div>
		</div>
		
		<!-- Modal-->
		<div class="modal fade" id="exampleModal2" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header">
		        <h1 class="modal-title fs-5" id="exampleModalLabel">비밀번호 찾기</h1>
		        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		      </div>
		      <div class="modal-body">
		        <div class="mb-3">
				  <label for="useremail" class="form-label">이메일</label>
				  <input type="text" id="useremail" name="useremail" class="form-control" placeholder="예) id@example.com" oninput="checkId(), activateJoinbtn()"/>
				  <font color = "red" id = "mailform" style = "display:none">올바른 이메일 형식이 아닙니다</font>
				  <font color = "red" id = "fail" style = "display:none">이미 존재하는 이메일입니다</font>
				  <font color = "green" id = "mailcon" style = "display:none">사용 가능한 이메일입니다</font>
				</div>
				<div class="input-group">
				  <input class="form-control mail-check-input" placeholder="인증번호 6자리를 입력해주세요" disabled="disabled">
				  <span><input type="button" class="form-control btn btn-secondary text-dark" id="mail-Check-Btn" value="인증 요청" style="background-color:#ece2c4;"></span>
				</div>
				<span class="mb-3" id="mail-check-warn"></span>
		      </div>
		      <div class="modal-footer">
		        <button id="closebtn" type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
		        <button id="askbtn" type="button" class="btn btn-primary" onclick="askregister();">등록</button>
		      </div>
		    </div>
		  </div>
		</div>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
        <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
        <!-- * *                               SB Forms JS                               * *-->
        <!-- * * Activate your form at https://startbootstrap.com/solution/contact-forms * *-->
        <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
        <script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>
    </body>
</html>
